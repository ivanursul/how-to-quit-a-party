<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∏—Å—Ç–µ—Ü—Ç–≤–æ –ù–µ–ø–æ–º—ñ—Ç–Ω–æ–≥–æ –í—ñ–¥—Ö–æ–¥—É –∑ –í–µ—á—ñ—Ä–∫–∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Hero Section */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            padding: 40px 20px;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.5;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .emoji-title {
            font-size: 80px;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 20px;
            background: linear-gradient(90deg, #e94560, #ff6b6b, #feca57);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #a0a0a0;
            margin-bottom: 40px;
            font-style: italic;
        }

        .scroll-indicator {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            animation: bounce 2s infinite;
            cursor: pointer;
        }

        .scroll-indicator span {
            display: block;
            width: 30px;
            height: 30px;
            border-bottom: 3px solid #e94560;
            border-right: 3px solid #e94560;
            transform: rotate(45deg);
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
            40% { transform: translateX(-50%) translateY(-20px); }
            60% { transform: translateX(-50%) translateY(-10px); }
        }

        /* Steps Section */
        .steps-section {
            padding: 60px 20px;
        }

        .section-title {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 60px;
            color: #feca57;
        }

        .step {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            border-left: 4px solid #e94560;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .step:hover {
            transform: translateX(10px);
            box-shadow: 0 10px 40px rgba(233, 69, 96, 0.2);
        }

        .step::before {
            content: attr(data-step);
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 4rem;
            font-weight: 800;
            color: rgba(255, 255, 255, 0.05);
        }

        .step-icon {
            font-size: 50px;
            margin-bottom: 20px;
        }

        .step h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #ff6b6b;
        }

        .step p {
            color: #c0c0c0;
            line-height: 1.8;
            font-size: 1.1rem;
        }

        .step .tip {
            margin-top: 20px;
            padding: 15px;
            background: rgba(254, 202, 87, 0.1);
            border-radius: 10px;
            border-left: 3px solid #feca57;
            font-size: 0.95rem;
            color: #feca57;
        }

        .step .tip::before {
            content: "Pro tip: ";
            font-weight: 600;
        }

        /* Warning Section */
        .warning-section {
            background: rgba(233, 69, 96, 0.1);
            padding: 40px;
            border-radius: 20px;
            margin: 40px 20px;
            text-align: center;
            border: 2px dashed #e94560;
        }

        .warning-section h2 {
            color: #e94560;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .warning-section ul {
            list-style: none;
            text-align: left;
            max-width: 500px;
            margin: 0 auto;
        }

        .warning-section li {
            padding: 10px 0;
            color: #c0c0c0;
            position: relative;
            padding-left: 30px;
        }

        .warning-section li::before {
            content: "‚ö†Ô∏è";
            position: absolute;
            left: 0;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 60px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        footer .quote {
            font-size: 1.3rem;
            font-style: italic;
            color: #a0a0a0;
            margin-bottom: 20px;
        }

        footer .author {
            color: #e94560;
            font-weight: 600;
        }

        .back-to-top {
            display: inline-block;
            margin-top: 40px;
            padding: 15px 40px;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            color: #fff;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 600;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .back-to-top:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(233, 69, 96, 0.4);
        }

        /* Responsive */
        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
            }

            .emoji-title {
                font-size: 60px;
            }

            .step {
                padding: 25px;
            }

            .step h3 {
                font-size: 1.2rem;
            }

            .section-title {
                font-size: 1.5rem;
            }
        }

        /* Party lights effect */
        .party-lights {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 0;
            opacity: 0.3;
        }

        .light {
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            filter: blur(80px);
            animation: pulse 4s ease-in-out infinite;
        }

        .light-1 {
            background: #e94560;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .light-2 {
            background: #feca57;
            top: 60%;
            right: 10%;
            animation-delay: 1s;
        }

        .light-3 {
            background: #48dbfb;
            bottom: 10%;
            left: 30%;
            animation-delay: 2s;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }

        /* Statistics Section */
        .stats-section {
            padding: 60px 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .stat-card .stat-number {
            font-size: 2rem;
            font-weight: 800;
            color: #feca57;
            margin-bottom: 5px;
        }

        .stat-card .stat-text {
            color: #a0a0a0;
            font-size: 0.9rem;
        }

        .escape-log {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }

        .escape-log h3 {
            color: #ff6b6b;
            margin-bottom: 20px;
            font-size: 1.3rem;
            text-align: center;
        }

        .log-entry {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.03);
            transition: background 0.3s ease;
        }

        .log-entry:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .log-entry.success {
            border-left: 4px solid #2ecc71;
        }

        .log-entry.fail {
            border-left: 4px solid #e94560;
        }

        .log-status {
            font-size: 1.5rem;
            margin-right: 15px;
        }

        .log-details {
            flex: 1;
        }

        .log-party {
            color: #fff;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .log-date {
            color: #666;
            font-size: 0.85rem;
        }

        .log-reason {
            color: #a0a0a0;
            font-size: 0.9rem;
            font-style: italic;
            margin-top: 5px;
        }

        .log-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .log-badge.success {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }

        .log-badge.fail {
            background: rgba(233, 69, 96, 0.2);
            color: #e94560;
        }

        .counter-animated {
            display: inline-block;
        }

        /* Game Section */
        .game-section {
            padding: 60px 20px;
            text-align: center;
        }

        .game-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            border: 2px solid #e94560;
        }

        #gameCanvas {
            border: 4px solid #feca57;
            border-radius: 8px;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            max-width: 100%;
            cursor: none;
        }

        .game-controls {
            margin-top: 20px;
            color: #a0a0a0;
        }

        .game-controls kbd {
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 12px;
            border-radius: 5px;
            border: 1px solid #555;
            font-family: monospace;
            margin: 0 3px;
        }

        .game-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 20px;
            border-radius: 10px;
        }

        .stat-label {
            color: #a0a0a0;
            font-size: 0.9rem;
        }

        .stat-value {
            color: #feca57;
            font-size: 1.5rem;
            font-weight: 800;
        }

        .game-btn {
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            font-family: 'Montserrat', sans-serif;
        }

        .game-btn-primary {
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            color: #fff;
        }

        .game-btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(233, 69, 96, 0.4);
        }

        .game-message {
            font-size: 1.2rem;
            margin: 15px 0;
            min-height: 30px;
        }

        .mobile-controls {
            display: none;
            margin-top: 20px;
            gap: 10px;
            justify-content: center;
        }

        .mobile-btn {
            width: 60px;
            height: 60px;
            font-size: 24px;
            background: rgba(233, 69, 96, 0.3);
            border: 2px solid #e94560;
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
            touch-action: manipulation;
        }

        .mobile-btn:active {
            background: rgba(233, 69, 96, 0.6);
        }

        .mobile-dpad {
            display: grid;
            grid-template-columns: repeat(3, 60px);
            grid-template-rows: repeat(3, 60px);
            gap: 5px;
        }

        .mobile-dpad .mobile-btn:nth-child(1) { grid-area: 1 / 2; }
        .mobile-dpad .mobile-btn:nth-child(2) { grid-area: 2 / 1; }
        .mobile-dpad .mobile-btn:nth-child(3) { grid-area: 2 / 3; }
        .mobile-dpad .mobile-btn:nth-child(4) { grid-area: 3 / 2; }

        @media (max-width: 768px) {
            .mobile-controls {
                display: flex;
            }
        }

        @media (max-width: 500px) {
            #gameCanvas {
                width: 100%;
                height: auto;
            }
        }
    </style>
</head>
<body>
    <div class="party-lights">
        <div class="light light-1"></div>
        <div class="light light-2"></div>
        <div class="light light-3"></div>
    </div>

    <div class="container">
        <!-- Hero Section -->
        <section class="hero" id="top">
            <div class="hero-content">
                <div class="emoji-title">ü•∑</div>
                <h1>–ú–∏—Å—Ç–µ—Ü—Ç–≤–æ –ù–µ–ø–æ–º—ñ—Ç–Ω–æ–≥–æ –í—ñ–¥—Ö–æ–¥—É –∑ –í–µ—á—ñ—Ä–∫–∏</h1>
                <p class="subtitle">–ü–æ–≤–Ω–∏–π –≥–∞–π–¥ –¥–ª—è —Ç–∏—Ö, —Ö—Ç–æ —Ü—ñ–Ω—É—î —Å–≤—ñ–π —á–∞—Å —Ç–∞ –Ω–µ–Ω–∞–≤–∏–¥–∏—Ç—å –¥–æ–≤–≥—ñ –ø—Ä–æ—â–∞–Ω–Ω—è</p>
            </div>
            <a href="#steps" class="scroll-indicator">
                <span></span>
            </a>
        </section>

        <!-- Steps Section -->
        <section class="steps-section" id="steps">
            <h2 class="section-title">üìã –ü–æ–∫—Ä–æ–∫–æ–≤–∞ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è</h2>

            <div class="step" data-step="01">
                <div class="step-icon">üîç</div>
                <h3>–ö—Ä–æ–∫ 1: –†–æ–∑–≤—ñ–¥–∫–∞ –¢–µ—Ä–∏—Ç–æ—Ä—ñ—ó</h3>
                <p>
                    –ü–µ—Ä—à –Ω—ñ–∂ –ø–ª–∞–Ω—É–≤–∞—Ç–∏ –≤—Ç–µ—á—É, –≤–∏–≤—á–∏ –ª–æ–∫–∞—Ü—ñ—é. –î–µ –≤–∏—Ö–æ–¥–∏? –î–µ —Ç—É–∞–ª–µ—Ç? –î–µ –≥–æ—Å–ø–æ–¥–∞—Ä?
                    –ó–∞–ø–∞–º'—è—Ç–∞–π —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –¥–≤–µ—Ä–µ–π —Ç–∞–∫, –Ω—ñ–±–∏ —Ç–∏ –≥–æ—Ç—É—î—à—Å—è –¥–æ –ø–æ–≥—Ä–∞–±—É–≤–∞–Ω–Ω—è –±–∞–Ω–∫—É,
                    –∞–ª–µ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –ø—Ä–æ—Å—Ç–æ —Ö–æ—á–µ—à –¥–æ–¥–æ–º—É –ø–æ–¥–∏–≤–∏—Ç–∏—Å—å —Å–µ—Ä—ñ–∞–ª.
                </p>
                <div class="tip">–ù—ñ–∫–æ–ª–∏ –Ω–µ —Å—ñ–¥–∞–π –≤ —Ü–µ–Ω—Ç—Ä—ñ –∫—ñ–º–Ω–∞—Ç–∏ ‚Äî –∑–∞–≤–∂–¥–∏ –æ–±–∏—Ä–∞–π –º—ñ—Å—Ü–µ –±–ª–∏–∂—á–µ –¥–æ –≤–∏—Ö–æ–¥—É!</div>
            </div>

            <div class="step" data-step="02">
                <div class="step-icon">‚è∞</div>
                <h3>–ö—Ä–æ–∫ 2: –í–∏–±—ñ—Ä –Ü–¥–µ–∞–ª—å–Ω–æ–≥–æ –ú–æ–º–µ–Ω—Ç—É</h3>
                <p>
                    –ù–∞–π–∫—Ä–∞—â–∏–π —á–∞—Å –¥–ª—è –≤—ñ–¥—Ö–æ–¥—É ‚Äî –∫–æ–ª–∏ –≤—Å—ñ –∑–∞–π–Ω—è—Ç—ñ. –•—Ç–æ—Å—å —Ä–æ–∑–ø–æ–≤—ñ–¥–∞—î –¥–æ–≤–≥—É —ñ—Å—Ç–æ—Ä—ñ—é?
                    –ü–æ—á–∞–≤—Å—è —Ç–∞–Ω—Ü—é–≤–∞–ª—å–Ω–∏–π –±–∞—Ç–ª? DJ –ø–æ—Å—Ç–∞–≤–∏–≤ —Ö—ñ—Ç —ñ –≤—Å—ñ –ø–æ–±—ñ–≥–ª–∏ —Ç–∞–Ω—Ü—é–≤–∞—Ç–∏?
                    –¶–µ —Ç–≤—ñ–π —à–∞–Ω—Å! –ù—ñ—Ö—Ç–æ –Ω–µ –ø–æ–º—ñ—Ç–∏—Ç—å —Ç–≤–æ—î—ó –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –≤ —Ä–æ–∑–ø–∞–ª –≤–µ—Å–µ–ª–æ—â—ñ–≤.
                </p>
                <div class="tip">–£–Ω–∏–∫–∞–π –º–æ–º–µ–Ω—Ç—ñ–≤, –∫–æ–ª–∏ —Ö—Ç–æ—Å—å –∫–∞–∂–µ "–ê –¥–µ –≤—Å—ñ? –î–∞–≤–∞–π—Ç–µ —Ñ–æ—Ç–∫–∞—Ç–∏—Å—å!"</div>
            </div>

            <div class="step" data-step="03">
                <div class="step-icon">üé≠</div>
                <h3>–ö—Ä–æ–∫ 3: –¢–µ—Ö–Ω—ñ–∫–∞ "–Ø –ó–∞—Ä–∞–∑ –ü–æ–≤–µ—Ä–Ω—É—Å—å"</h3>
                <p>
                    –ö–ª–∞—Å–∏–∫–∞ –∂–∞–Ω—Ä—É! –°–∫–∞–∂–∏ –∫–æ–º—É—Å—å, —â–æ –π–¥–µ—à –¥–æ —Ç—É–∞–ª–µ—Ç—É, –∞–±–æ –≤–∏–π–¥–µ—à –ø–æ–∫—É—Ä–∏—Ç–∏,
                    –∞–±–æ –≤—ñ–∑—å–º–µ—à —â–æ—Å—å –∑ –º–∞—à–∏–Ω–∏. –ì–æ–ª–æ–≤–Ω–µ ‚Äî —Å–∫–∞–∑–∞—Ç–∏ —Ü–µ –≤–ø–µ–≤–Ω–µ–Ω–æ —ñ –∑ –ø–æ—Å–º—ñ—à–∫–æ—é.
                    –ù—ñ—Ö—Ç–æ –Ω–µ –∑–∞–ø—ñ–¥–æ–∑—Ä–∏—Ç—å, —â–æ —Ç–∏ –≤–∂–µ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –ø–æ–≤–µ—Ä–Ω–µ—à—Å—è.
                </p>
                <div class="tip">–ó–∞–ª–∏—à –Ω–∞ —Å—Ç–æ–ª—ñ –Ω–∞–ø—ñ–≤–ø–æ—Ä–æ–∂–Ω—é —Å–∫–ª—è–Ω–∫—É ‚Äî —Ü–µ —Å—Ç–≤–æ—Ä–∏—Ç—å —ñ–ª—é–∑—ñ—é —Ç–≤–æ—î—ó –ø—Ä–∏—Å—É—Ç–Ω–æ—Å—Ç—ñ!</div>
            </div>

            <div class="step" data-step="04">
                <div class="step-icon">üö∂</div>
                <h3>–ö—Ä–æ–∫ 4: –ü–æ–≤—ñ–ª—å–Ω–∏–π –†—É—Ö –¥–æ –í–∏—Ö–æ–¥—É</h3>
                <p>
                    –ù–µ –±—ñ–∂–∏! –†—É—Ö–∞–π—Å—è —Å–ø–æ–∫—ñ–π–Ω–æ —Ç–∞ –≤–ø–µ–≤–Ω–µ–Ω–æ. –ú–æ–∂–µ—à —É–¥–∞–≤–∞—Ç–∏, —â–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—à —Ç–µ–ª–µ—Ñ–æ–Ω
                    –∞–±–æ —à—É–∫–∞—î—à –∫–æ–≥–æ—Å—å –ø–æ–≥–ª—è–¥–æ–º. –Ø–∫—â–æ —Ö—Ç–æ—Å—å —Ç–µ–±–µ –ø–æ–º—ñ—Ç–∏—Ç—å —ñ –∑–∞–ø–∏—Ç–∞—î –∫—É–¥–∏ —Ç–∏ ‚Äî
                    —Å–∫–∞–∂–∏ "–≤ —Ç—É–∞–ª–µ—Ç" —ñ –ø—Ä–æ–¥–æ–≤–∂—É–π —Ä—É—Ö. –¢—É–∞–ª–µ—Ç ‚Äî —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∞ –≤—ñ–¥–º–∞–∑–∫–∞.
                </p>
                <div class="tip">–¢—Ä–∏–º–∞–π –∫—É—Ä—Ç–∫—É –≤ —Ä—É–∫–∞—Ö —Ç–∞–∫, –Ω—ñ–±–∏ –Ω–µ—Å–µ—à –∫–æ–º—É—Å—å —ñ–Ω—à–æ–º—É!</div>
            </div>

            <div class="step" data-step="05">
                <div class="step-icon">üö™</div>
                <h3>–ö—Ä–æ–∫ 5: –§—ñ–Ω–∞–ª—å–Ω–∏–π –†–∏–≤–æ–∫</h3>
                <p>
                    –ö–æ–ª–∏ –¥–æ –¥–≤–µ—Ä–µ–π –∑–∞–ª–∏—à–∏–ª–æ—Å—å 2-3 –º–µ—Ç—Ä–∏ ‚Äî –Ω–µ –∑—É–ø–∏–Ω—è–π—Å—è! –¶–µ –Ω–∞–π–Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ—à–∞ –∑–æ–Ω–∞.
                    –°–∞–º–µ —Ç—É—Ç —Ç–µ–±–µ –º–æ–∂—É—Ç—å —Å–ø—ñ–π–º–∞—Ç–∏ —ñ –∑–∞—Ç—è–≥–Ω—É—Ç–∏ –≤ —Ä–æ–∑–º–æ–≤—É –ø—Ä–æ "–∞ –ø–∞–º'—è—Ç–∞—î—à —è–∫ –º–∏..."
                    –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ 40 —Ö–≤–∏–ª–∏–Ω. –î—ñ–π —à–≤–∏–¥–∫–æ, –∞–ª–µ –Ω–µ –ø–∞–Ω—ñ—á–Ω–æ.
                </p>
                <div class="tip">–Ø–∫—â–æ –¥–≤–µ—Ä—ñ —Å–∫—Ä–∏–ø–ª—è—Ç—å ‚Äî –≤—ñ–¥–∫—Ä–∏–≤–∞–π —ó—Ö –ø–æ–≤—ñ–ª—å–Ω–æ, –ø—ñ–¥ –ø—Ä–∏–∫—Ä–∏—Ç—Ç—è–º –≥—É—á–Ω–æ—ó –º—É–∑–∏–∫–∏!</div>
            </div>

            <div class="step" data-step="06">
                <div class="step-icon">üèÉ‚Äç‚ôÇÔ∏è</div>
                <h3>–ö—Ä–æ–∫ 6: –ï–≤–∞–∫—É–∞—Ü—ñ—è</h3>
                <p>
                    –¢–∏ –Ω–∞–¥–≤–æ—Ä—ñ! –ê–ª–µ —â–µ –Ω–µ —Å–≤—è—Ç–∫—É–π. –®–≤–∏–¥–∫–æ –π–¥–∏ –¥–æ –º–∞—à–∏–Ω–∏/–∑—É–ø–∏–Ω–∫–∏/—Ç–∞–∫—Å–∏.
                    –ù–µ –æ–∑–∏—Ä–∞–π—Å—è ‚Äî —Ü–µ –≤–∏–≥–ª—è–¥–∞—î –ø—ñ–¥–æ–∑—Ä—ñ–ª–æ. –ô–¥–∏ —Ç–∞–∫, –Ω—ñ–±–∏ —Ç–∏ –ø—Ä–æ—Å—Ç–æ –≤–∏–π—à–æ–≤
                    –ø–æ–¥–∏—Ö–∞—Ç–∏ —Å–≤—ñ–∂–∏–º –ø–æ–≤—ñ—Ç—Ä—è–º —ñ —Ç–æ—á–Ω–æ –ø–æ–≤–µ—Ä–Ω–µ—à—Å—è... –∫–æ–ª–∏—Å—å... –º–æ–∂–ª–∏–≤–æ... –Ω—ñ.
                </p>
                <div class="tip">–ó–∞–º–æ–≤ —Ç–∞–∫—Å—ñ –∑–∞–∑–¥–∞–ª–µ–≥—ñ–¥—å, —â–æ–± –≤–æ–Ω–æ –≤–∂–µ —á–µ–∫–∞–ª–æ –∑–∞ —Ä–æ–≥–æ–º!</div>
            </div>

            <div class="step" data-step="07">
                <div class="step-icon">üì±</div>
                <h3>–ö—Ä–æ–∫ 7: –ê–ª—ñ–±—ñ</h3>
                <p>
                    –ß–µ—Ä–µ–∑ 30 —Ö–≤–∏–ª–∏–Ω –Ω–∞–¥—ñ—à–ª–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ —á–∞—Ç: "–°–æ—Ä—ñ, –º—É—Å—ñ–≤ —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ –ø—ñ—Ç–∏,
                    –º–∞–º—ñ —Å—Ç–∞–ª–æ –ø–æ–≥–∞–Ω–æ / –∫—ñ—Ç –∑–∞–±–ª—É–∫–∞–≤ / –∫–≤–∞—Ä—Ç–∏—Ä—É –∑–∞—Ç–æ–ø–∏–ª–æ / –ø—Ä–∏–π—à–ª–∞ –ø–æ—Å–∏–ª–∫–∞ –∑ –ö–∏—Ç–∞—é".
                    –û–±–∏—Ä–∞–π –±—É–¥—å-—è–∫—É –≤—ñ–¥–º–∞–∑–∫—É, –∞–ª–µ –Ω–µ –ø–µ—Ä–µ—Å—Ç–∞—Ä–∞–π—Å—è –∑ –¥—Ä–∞–º–æ—é.
                </p>
                <div class="tip">–ó–∞–≥–æ—Ç—É–π –≤—ñ–¥–º–∞–∑–∫—É –©–ï –î–û –≤–µ—á—ñ—Ä–∫–∏. –Ü–º–ø—Ä–æ–≤—ñ–∑–∞—Ü—ñ—è ‚Äî –≤–æ—Ä–æ–≥ —É—Å–ø—ñ—à–Ω–æ—ó –≤—Ç–µ—á—ñ!</div>
            </div>
        </section>

        <!-- Warning Section -->
        <div class="warning-section">
            <h2>‚ö†Ô∏è –¢–∏–ø–æ–≤—ñ –ü–æ–º–∏–ª–∫–∏ –ù–æ–≤–∞—á–∫—ñ–≤</h2>
            <ul>
                <li>–ü—Ä–æ—â–∞—Ç–∏—Å—å "—Ç—ñ–ª—å–∫–∏ –∑ –æ–¥–Ω–∏–º –¥—Ä—É–≥–æ–º" ‚Äî —Ü–µ –∑–∞–≤–∂–¥–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–∞ –≥–æ–¥–∏–Ω—É –ø—Ä–æ—â–∞–Ω—å</li>
                <li>–ö–∞–∑–∞—Ç–∏ "—è —Å–∫–æ—Ä–æ –ø—ñ–¥—É" ‚Äî —Ç–µ–±–µ –ø–æ—á–Ω—É—Ç—å —É–º–æ–≤–ª—è—Ç–∏ –∑–∞–ª–∏—à–∏—Ç–∏—Å—å</li>
                <li>–ó–∞–±—É—Ç–∏ –∫–ª—é—á—ñ/—Å—É–º–∫—É/—Ç–µ–ª–µ—Ñ–æ–Ω —ñ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏—Å—å ‚Äî –º—ñ—Å—ñ—è –ø—Ä–æ–≤–∞–ª–µ–Ω–∞</li>
                <li>–ü–æ—Å—Ç–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–∑ –≤–∂–µ –∑ –¥–æ–º—É, –∫–æ–ª–∏ –≤–µ—á—ñ—Ä–∫–∞ —â–µ —Ç—Ä–∏–≤–∞—î</li>
                <li>–ù–∞–º–∞–≥–∞—Ç–∏—Å—å —Ç–∏—Ö–æ –≤—ñ–¥—á–∏–Ω–∏—Ç–∏ —Å–∫–ª—è–Ω—ñ –¥–≤–µ—Ä—ñ ‚Äî –≤–æ–Ω–∏ –∑–∞–≤–∂–¥–∏ –≥—Ä–∏–º–ª—è—Ç—å</li>
            </ul>
        </div>

        <!-- Statistics Section -->
        <section class="stats-section" id="stats">
            <h2 class="section-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –í—Ç–µ—á</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üèÉ</div>
                    <div class="stat-number">1</div>
                    <div class="stat-text">–°–ø—Ä–æ–± –≤—Ç–µ—á—ñ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-number">0</div>
                    <div class="stat-text">–£—Å–ø—ñ—à–Ω–∏—Ö</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üò±</div>
                    <div class="stat-number">1</div>
                    <div class="stat-text">–ü—Ä–æ–≤–∞–ª–µ–Ω–∏—Ö</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-number">0%</div>
                    <div class="stat-text">–£—Å–ø—ñ—à–Ω—ñ—Å—Ç—å</div>
                </div>
            </div>

            <div class="escape-log">
                <h3>üìú –ñ—É—Ä–Ω–∞–ª –û—Å—Ç–∞–Ω–Ω—ñ—Ö –°–ø—Ä–æ–±</h3>

                <div class="log-entry fail">
                    <div class="log-status">üíÄ</div>
                    <div class="log-details">
                        <div class="log-party">–®–∏—Ä–æ–≥–æ –¥–µ–Ω—å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</div>
                        <div class="log-date">10 —Å—ñ—á–Ω—è 2026</div>
                        <div class="log-reason">"–ü–æ–ø—Ä–æ—â–∞–≤—Å—è –∑ –æ–¥–Ω—ñ—î—é –ª—é–¥–∏–Ω–æ—é, –ø–æ–∫–ª–∏–∫–∞–≤ –ü–∞–≤–ª–∞ —ñ –î—î–Ω—é, –±–∞–≥–∞—Ç–æ –ª—é–¥–µ–π –ø–æ—á–∞–ª–∏ –ø–∏—Ç–∞—Ç–∏—Å—å —á–æ–º—É –π–¥–µ—à."</div>
                    </div>
                    <div class="log-badge fail">–ü–†–û–í–ê–õ</div>
                </div>
            </div>
        </section>

        <!-- Game Section -->
        <section class="game-section" id="game">
            <h2 class="section-title">üéÆ –¢—Ä–µ–Ω–∞–∂–µ—Ä –í—Ç–µ—á—ñ</h2>
            <p style="color: #a0a0a0; margin-bottom: 20px;">–í—ñ–¥—Ç–æ—á–∏ —Å–≤–æ—ó –Ω–∞–≤–∏—á–∫–∏ –≤—Ç–µ—á—ñ –∑ –≤–µ—á—ñ—Ä–∫–∏ –≤ —Ü—ñ–π –ø—ñ–∫—Å–µ–ª—å–Ω—ñ–π –≥—Ä—ñ!</p>

            <div class="game-container">
                <div class="game-stats">
                    <div class="stat">
                        <div class="stat-label">–†—ñ–≤–µ–Ω—å</div>
                        <div class="stat-value" id="levelDisplay">1</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">–ß–∞—Å</div>
                        <div class="stat-value" id="timeDisplay">60</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">–°–ø—ñ–π–º–∞–Ω–æ</div>
                        <div class="stat-value" id="caughtDisplay">0/3</div>
                    </div>
                </div>

                <canvas id="gameCanvas" width="480" height="320"></canvas>

                <div class="game-message" id="gameMessage">–ù–∞—Ç–∏—Å–Ω–∏ "–ü–æ—á–∞—Ç–∏ –ì—Ä—É" —â–æ–± —Ä–æ–∑–ø–æ—á–∞—Ç–∏!</div>

                <button class="game-btn game-btn-primary" id="startBtn">üéÆ –ü–æ—á–∞—Ç–∏ –ì—Ä—É</button>

                <div class="mobile-controls">
                    <div class="mobile-dpad">
                        <button class="mobile-btn" data-dir="up">‚Üë</button>
                        <button class="mobile-btn" data-dir="left">‚Üê</button>
                        <button class="mobile-btn" data-dir="right">‚Üí</button>
                        <button class="mobile-btn" data-dir="down">‚Üì</button>
                    </div>
                </div>

                <div class="game-controls">
                    <p>–ö–µ—Ä—É–≤–∞–Ω–Ω—è: <kbd>‚Üë</kbd> <kbd>‚Üì</kbd> <kbd>‚Üê</kbd> <kbd>‚Üí</kbd> –∞–±–æ <kbd>W</kbd> <kbd>A</kbd> <kbd>S</kbd> <kbd>D</kbd></p>
                    <p style="margin-top: 10px; font-size: 0.9rem;">üéØ –î—ñ—Å—Ç–∞–Ω—å—Å—è –¥–æ –¥–≤–µ—Ä–µ–π! üì± –ó–±–∏—Ä–∞–π —Ç–µ–ª–µ—Ñ–æ–Ω–∏ –¥–ª—è –Ω–µ–≤–∏–¥–∏–º–æ—Å—Ç—ñ!</p>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <p class="quote">
                "–°–ø—Ä–∞–≤–∂–Ω—ñ–π –º–∞–π—Å—Ç–µ—Ä –π–¥–µ —Ç–∞–∫ —Ç–∏—Ö–æ, —â–æ –Ω–∞–≤—ñ—Ç—å –Ω–µ —á—É—î –≤–ª–∞—Å–Ω–∏—Ö –∫—Ä–æ–∫—ñ–≤.
                –ê —â–µ –∫—Ä–∞—â–µ ‚Äî –∫–æ–ª–∏ –π–æ–≥–æ –≤–∑–∞–≥–∞–ª—ñ –Ω–µ –ø–æ–º—ñ—á–∞—é—Ç—å."
            </p>
            <p class="author">‚Äî –°—Ç–∞—Ä–æ–¥–∞–≤–Ω—è –º—É–¥—Ä—ñ—Å—Ç—å —ñ–Ω—Ç—Ä–æ–≤–µ—Ä—Ç—ñ–≤</p>

            <a href="#top" class="back-to-top">üîù –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –Ω–∞ –ø–æ—á–∞—Ç–æ–∫</a>
        </footer>
    </div>

    <script>
        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth'
                    });
                }
            });
        });

        // Add subtle parallax effect to party lights
        document.addEventListener('mousemove', (e) => {
            const lights = document.querySelectorAll('.light');
            const x = e.clientX / window.innerWidth;
            const y = e.clientY / window.innerHeight;

            lights.forEach((light, index) => {
                const speed = (index + 1) * 20;
                light.style.transform = `translate(${x * speed}px, ${y * speed}px)`;
            });
        });

        // Animated counters
        function animateCounters() {
            const counters = document.querySelectorAll('.counter-animated');

            counters.forEach(counter => {
                const target = parseInt(counter.dataset.target);
                const duration = 2000;
                const startTime = performance.now();

                function updateCounter(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const easeOut = 1 - Math.pow(1 - progress, 3);
                    const current = Math.floor(easeOut * target);

                    counter.textContent = current.toLocaleString();

                    if (progress < 1) {
                        requestAnimationFrame(updateCounter);
                    }
                }

                requestAnimationFrame(updateCounter);
            });
        }

        // Trigger counters when stats section is in view
        const statsSection = document.getElementById('stats');
        let countersAnimated = false;

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !countersAnimated) {
                    countersAnimated = true;
                    animateCounters();
                }
            });
        }, { threshold: 0.3 });

        if (statsSection) {
            observer.observe(statsSection);
        }

        // ============== PARTY ESCAPE GAME ==============
        (function() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const startBtn = document.getElementById('startBtn');
            const gameMessage = document.getElementById('gameMessage');
            const levelDisplay = document.getElementById('levelDisplay');
            const timeDisplay = document.getElementById('timeDisplay');
            const caughtDisplay = document.getElementById('caughtDisplay');

            // Game constants
            const TILE_SIZE = 16;
            const PLAYER_SIZE = 14;
            const COLS = canvas.width / TILE_SIZE;
            const ROWS = canvas.height / TILE_SIZE;

            // Colors (pixel art palette)
            const COLORS = {
                floor: '#2d1b4e',
                floorPattern: '#3d2b5e',
                wall: '#1a1a2e',
                table: '#8b4513',
                tableTop: '#a0522d',
                couch: '#4a0e4e',
                couchHighlight: '#6a2e6e',
                dj: '#333',
                djLight: '#e94560',
                player: '#48dbfb',
                playerOutline: '#0984e3',
                guest: '#ff6b6b',
                guestOutline: '#c0392b',
                door: '#27ae60',
                doorHighlight: '#2ecc71',
                phone: '#feca57',
                invisible: 'rgba(72, 219, 251, 0.3)'
            };

            // Game state
            let gameRunning = false;
            let level = 1;
            let timeLeft = 60;
            let caughtCount = 0;
            let maxCaught = 3;
            let timer = null;

            // Player
            let player = {
                x: 40,
                y: 160,
                speed: 2,
                invisible: false,
                invisibleTimer: 0
            };

            // Door position
            let door = { x: 448, y: 144, width: 32, height: 48 };

            // Obstacles (tables, couches, DJ booth)
            let obstacles = [];

            // NPCs (party guests)
            let guests = [];

            // Power-ups
            let powerups = [];

            // Keys pressed
            let keys = {};

            // Generate level
            function generateLevel() {
                obstacles = [];
                guests = [];
                powerups = [];

                // Reset player
                player.x = 40;
                player.y = 160;
                player.invisible = false;
                player.invisibleTimer = 0;

                // Add walls (borders)
                // Top and bottom walls are implied by canvas edge

                // Add furniture based on level
                // DJ Booth (top right)
                obstacles.push({ x: 380, y: 20, width: 80, height: 40, type: 'dj' });

                // Tables
                obstacles.push({ x: 120, y: 60, width: 64, height: 32, type: 'table' });
                obstacles.push({ x: 200, y: 200, width: 64, height: 32, type: 'table' });
                obstacles.push({ x: 300, y: 120, width: 48, height: 32, type: 'table' });

                // Couches
                obstacles.push({ x: 20, y: 240, width: 80, height: 32, type: 'couch' });
                obstacles.push({ x: 350, y: 240, width: 80, height: 32, type: 'couch' });

                // Add more obstacles for higher levels
                if (level >= 2) {
                    obstacles.push({ x: 180, y: 100, width: 32, height: 48, type: 'table' });
                }
                if (level >= 3) {
                    obstacles.push({ x: 280, y: 220, width: 48, height: 32, type: 'couch' });
                }

                // Add guests
                const guestCount = 2 + level;
                const guestPositions = [
                    { x: 150, y: 120 },
                    { x: 250, y: 180 },
                    { x: 350, y: 100 },
                    { x: 200, y: 260 },
                    { x: 320, y: 200 },
                    { x: 100, y: 200 },
                    { x: 400, y: 180 }
                ];

                for (let i = 0; i < Math.min(guestCount, guestPositions.length); i++) {
                    guests.push({
                        x: guestPositions[i].x,
                        y: guestPositions[i].y,
                        speed: 0.5 + (level * 0.2),
                        direction: Math.random() * Math.PI * 2,
                        changeTimer: 0,
                        chasing: false,
                        visionRange: 60 + (level * 10)
                    });
                }

                // Add power-ups (phones)
                const phoneCount = Math.max(1, 3 - Math.floor(level / 2));
                for (let i = 0; i < phoneCount; i++) {
                    let validPos = false;
                    let px, py;
                    while (!validPos) {
                        px = 80 + Math.random() * 320;
                        py = 40 + Math.random() * 240;
                        validPos = !checkCollision({ x: px, y: py, width: 16, height: 16 });
                    }
                    powerups.push({ x: px, y: py, type: 'phone', collected: false });
                }
            }

            // Check collision with obstacles
            function checkCollision(rect) {
                for (let obs of obstacles) {
                    if (rectIntersect(rect, obs)) return true;
                }
                return false;
            }

            // Rectangle intersection
            function rectIntersect(r1, r2) {
                return r1.x < r2.x + r2.width &&
                       r1.x + (r1.width || PLAYER_SIZE) > r2.x &&
                       r1.y < r2.y + r2.height &&
                       r1.y + (r1.height || PLAYER_SIZE) > r2.y;
            }

            // Draw pixel art rectangle with outline
            function drawPixelRect(x, y, w, h, color, outlineColor) {
                ctx.fillStyle = color;
                ctx.fillRect(Math.floor(x), Math.floor(y), w, h);
                if (outlineColor) {
                    ctx.strokeStyle = outlineColor;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(Math.floor(x), Math.floor(y), w, h);
                }
            }

            // Draw the game
            function draw() {
                // Clear canvas
                ctx.fillStyle = COLORS.floor;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Draw floor pattern
                ctx.fillStyle = COLORS.floorPattern;
                for (let x = 0; x < COLS; x++) {
                    for (let y = 0; y < ROWS; y++) {
                        if ((x + y) % 2 === 0) {
                            ctx.fillRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
                        }
                    }
                }

                // Draw disco lights effect
                const time = Date.now() / 500;
                for (let i = 0; i < 3; i++) {
                    const lightX = 200 + Math.sin(time + i * 2) * 100;
                    const lightY = 100 + Math.cos(time + i * 2) * 50;
                    const gradient = ctx.createRadialGradient(lightX, lightY, 0, lightX, lightY, 80);
                    const hue = (time * 50 + i * 120) % 360;
                    gradient.addColorStop(0, `hsla(${hue}, 70%, 50%, 0.15)`);
                    gradient.addColorStop(1, 'transparent');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }

                // Draw obstacles
                for (let obs of obstacles) {
                    if (obs.type === 'table') {
                        drawPixelRect(obs.x, obs.y + 4, obs.width, obs.height - 4, COLORS.table);
                        drawPixelRect(obs.x + 2, obs.y, obs.width - 4, 8, COLORS.tableTop);
                        // Table legs
                        ctx.fillStyle = '#5d3a1a';
                        ctx.fillRect(obs.x + 4, obs.y + obs.height - 4, 4, 4);
                        ctx.fillRect(obs.x + obs.width - 8, obs.y + obs.height - 4, 4, 4);
                    } else if (obs.type === 'couch') {
                        drawPixelRect(obs.x, obs.y, obs.width, obs.height, COLORS.couch);
                        drawPixelRect(obs.x + 4, obs.y + 4, obs.width - 8, obs.height - 12, COLORS.couchHighlight);
                        // Armrests
                        drawPixelRect(obs.x, obs.y + 4, 6, obs.height - 8, COLORS.couchHighlight);
                        drawPixelRect(obs.x + obs.width - 6, obs.y + 4, 6, obs.height - 8, COLORS.couchHighlight);
                    } else if (obs.type === 'dj') {
                        drawPixelRect(obs.x, obs.y, obs.width, obs.height, COLORS.dj);
                        // DJ equipment
                        ctx.fillStyle = '#444';
                        ctx.fillRect(obs.x + 10, obs.y + 8, 20, 15);
                        ctx.fillRect(obs.x + 50, obs.y + 8, 20, 15);
                        // Blinking light
                        ctx.fillStyle = Math.sin(Date.now() / 200) > 0 ? COLORS.djLight : '#ff0000';
                        ctx.fillRect(obs.x + 36, obs.y + 5, 8, 8);
                    }
                }

                // Draw door
                drawPixelRect(door.x, door.y, door.width, door.height, COLORS.door, COLORS.doorHighlight);
                // Door handle
                ctx.fillStyle = '#feca57';
                ctx.fillRect(door.x + 6, door.y + door.height / 2, 4, 6);
                // EXIT sign
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 10px monospace';
                ctx.fillText('EXIT', door.x + 4, door.y - 5);
                // Glowing effect
                if (Math.sin(Date.now() / 300) > 0) {
                    ctx.fillStyle = 'rgba(46, 204, 113, 0.3)';
                    ctx.fillRect(door.x - 4, door.y - 4, door.width + 8, door.height + 8);
                }

                // Draw power-ups
                for (let pu of powerups) {
                    if (!pu.collected) {
                        // Phone icon
                        ctx.fillStyle = COLORS.phone;
                        ctx.fillRect(pu.x, pu.y, 12, 18);
                        ctx.fillStyle = '#333';
                        ctx.fillRect(pu.x + 2, pu.y + 2, 8, 12);
                        ctx.fillStyle = '#48dbfb';
                        ctx.fillRect(pu.x + 4, pu.y + 14, 4, 2);
                        // Glow
                        ctx.beginPath();
                        ctx.arc(pu.x + 6, pu.y + 9, 12, 0, Math.PI * 2);
                        ctx.fillStyle = 'rgba(254, 202, 87, 0.2)';
                        ctx.fill();
                    }
                }

                // Draw guests
                for (let guest of guests) {
                    // Vision cone (if not invisible)
                    if (!player.invisible) {
                        ctx.fillStyle = guest.chasing ? 'rgba(255, 0, 0, 0.1)' : 'rgba(255, 255, 255, 0.05)';
                        ctx.beginPath();
                        ctx.arc(guest.x + 8, guest.y + 8, guest.visionRange, 0, Math.PI * 2);
                        ctx.fill();
                    }

                    // Guest body
                    ctx.fillStyle = guest.chasing ? '#ff0000' : COLORS.guest;
                    ctx.fillRect(guest.x, guest.y + 4, 16, 16);
                    // Head
                    ctx.fillRect(guest.x + 3, guest.y, 10, 10);
                    // Eyes
                    ctx.fillStyle = '#fff';
                    ctx.fillRect(guest.x + 5, guest.y + 3, 3, 3);
                    ctx.fillRect(guest.x + 10, guest.y + 3, 3, 3);
                    // Exclamation mark if chasing
                    if (guest.chasing) {
                        ctx.fillStyle = '#ff0000';
                        ctx.font = 'bold 14px monospace';
                        ctx.fillText('!', guest.x + 6, guest.y - 5);
                    }
                }

                // Draw player
                if (player.invisible) {
                    ctx.globalAlpha = 0.4;
                    ctx.fillStyle = COLORS.invisible;
                } else {
                    ctx.fillStyle = COLORS.player;
                }
                // Player body
                ctx.fillRect(player.x, player.y + 4, 14, 14);
                // Head
                ctx.fillRect(player.x + 2, player.y, 10, 8);
                // Ninja mask
                ctx.fillStyle = player.invisible ? 'rgba(0,0,0,0.3)' : '#1a1a2e';
                ctx.fillRect(player.x + 2, player.y + 2, 10, 4);
                // Eyes
                ctx.fillStyle = '#fff';
                ctx.fillRect(player.x + 4, player.y + 3, 2, 2);
                ctx.fillRect(player.x + 9, player.y + 3, 2, 2);

                ctx.globalAlpha = 1;

                // Draw invisibility timer bar
                if (player.invisible) {
                    ctx.fillStyle = 'rgba(0,0,0,0.5)';
                    ctx.fillRect(player.x - 3, player.y - 8, 20, 4);
                    ctx.fillStyle = '#48dbfb';
                    ctx.fillRect(player.x - 3, player.y - 8, 20 * (player.invisibleTimer / 180), 4);
                }
            }

            // Update game state
            function update() {
                if (!gameRunning) return;

                // Player movement
                let newX = player.x;
                let newY = player.y;

                if (keys['ArrowUp'] || keys['KeyW']) newY -= player.speed;
                if (keys['ArrowDown'] || keys['KeyS']) newY += player.speed;
                if (keys['ArrowLeft'] || keys['KeyA']) newX -= player.speed;
                if (keys['ArrowRight'] || keys['KeyD']) newX += player.speed;

                // Check boundaries
                newX = Math.max(0, Math.min(canvas.width - PLAYER_SIZE, newX));
                newY = Math.max(0, Math.min(canvas.height - PLAYER_SIZE, newY));

                // Check collision with obstacles
                const playerRect = { x: newX, y: newY, width: PLAYER_SIZE, height: PLAYER_SIZE + 4 };
                if (!checkCollision(playerRect)) {
                    player.x = newX;
                    player.y = newY;
                } else {
                    // Try sliding along walls
                    const playerRectX = { x: newX, y: player.y, width: PLAYER_SIZE, height: PLAYER_SIZE + 4 };
                    const playerRectY = { x: player.x, y: newY, width: PLAYER_SIZE, height: PLAYER_SIZE + 4 };
                    if (!checkCollision(playerRectX)) player.x = newX;
                    if (!checkCollision(playerRectY)) player.y = newY;
                }

                // Update invisibility
                if (player.invisible) {
                    player.invisibleTimer--;
                    if (player.invisibleTimer <= 0) {
                        player.invisible = false;
                    }
                }

                // Check power-up collection
                for (let pu of powerups) {
                    if (!pu.collected) {
                        const dist = Math.hypot(player.x - pu.x, player.y - pu.y);
                        if (dist < 20) {
                            pu.collected = true;
                            player.invisible = true;
                            player.invisibleTimer = 180; // 3 seconds at 60fps
                            gameMessage.textContent = 'üì± –ù–µ–≤–∏–¥–∏–º—ñ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ!';
                            gameMessage.style.color = '#48dbfb';
                        }
                    }
                }

                // Update guests
                for (let guest of guests) {
                    // Check if player is in vision
                    const dist = Math.hypot((player.x + 7) - (guest.x + 8), (player.y + 9) - (guest.y + 8));

                    if (!player.invisible && dist < guest.visionRange) {
                        guest.chasing = true;
                        // Move towards player
                        const angle = Math.atan2(player.y - guest.y, player.x - guest.x);
                        guest.x += Math.cos(angle) * guest.speed * 1.5;
                        guest.y += Math.sin(angle) * guest.speed * 1.5;
                    } else {
                        guest.chasing = false;
                        // Random patrol movement
                        guest.changeTimer++;
                        if (guest.changeTimer > 60 + Math.random() * 60) {
                            guest.direction = Math.random() * Math.PI * 2;
                            guest.changeTimer = 0;
                        }

                        const newGx = guest.x + Math.cos(guest.direction) * guest.speed;
                        const newGy = guest.y + Math.sin(guest.direction) * guest.speed;

                        // Keep guests in bounds and away from obstacles
                        if (newGx > 20 && newGx < canvas.width - 40 &&
                            newGy > 20 && newGy < canvas.height - 40 &&
                            !checkCollision({ x: newGx, y: newGy, width: 16, height: 20 })) {
                            guest.x = newGx;
                            guest.y = newGy;
                        } else {
                            guest.direction = Math.random() * Math.PI * 2;
                        }
                    }

                    // Check if guest caught player
                    if (dist < 18 && !player.invisible) {
                        caughtCount++;
                        caughtDisplay.textContent = `${caughtCount}/${maxCaught}`;

                        if (caughtCount >= maxCaught) {
                            gameOver(false);
                            return;
                        }

                        // Reset player position
                        player.x = 40;
                        player.y = 160;
                        gameMessage.textContent = 'üò± –¢–µ–±–µ —Å–ø—ñ–π–º–∞–ª–∏! "–ê –∫—É–¥–∏ —Ü–µ —Ç–∏ –π–¥–µ—à?"';
                        gameMessage.style.color = '#e94560';
                    }
                }

                // Check if player reached door
                if (rectIntersect({ x: player.x, y: player.y, width: PLAYER_SIZE, height: PLAYER_SIZE + 4 }, door)) {
                    levelComplete();
                }
            }

            // Level complete
            function levelComplete() {
                level++;
                levelDisplay.textContent = level;
                timeLeft = Math.max(30, 60 - (level - 1) * 5);
                timeDisplay.textContent = timeLeft;
                gameMessage.textContent = `üéâ –†—ñ–≤–µ–Ω—å ${level - 1} –ø—Ä–æ–π–¥–µ–Ω–æ! –ì–æ—Ç—É–π—Å—è –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ...`;
                gameMessage.style.color = '#2ecc71';

                generateLevel();
            }

            // Game over
            function gameOver(won) {
                gameRunning = false;
                clearInterval(timer);

                if (won) {
                    gameMessage.textContent = 'üèÜ –¢–∏ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π –º–∞–π—Å—Ç–µ—Ä –≤—Ç–µ—á—ñ!';
                    gameMessage.style.color = '#2ecc71';
                } else {
                    gameMessage.textContent = 'üíÄ –ì—Ä–∞ –∑–∞–∫—ñ–Ω—á–µ–Ω–∞! –¢–µ–±–µ –∑–∞—Ç—Ä–∏–º–∞–ª–∏ –Ω—É–¥–Ω–∏–º–∏ —Ä–æ–∑–º–æ–≤–∞–º–∏...';
                    gameMessage.style.color = '#e94560';
                }

                startBtn.textContent = 'üîÑ –ì—Ä–∞—Ç–∏ –ó–Ω–æ–≤—É';
                startBtn.style.display = 'inline-block';
            }

            // Game loop
            function gameLoop() {
                update();
                draw();
                if (gameRunning) {
                    requestAnimationFrame(gameLoop);
                }
            }

            // Start game
            function startGame() {
                level = 1;
                timeLeft = 60;
                caughtCount = 0;
                gameRunning = true;

                levelDisplay.textContent = level;
                timeDisplay.textContent = timeLeft;
                caughtDisplay.textContent = `${caughtCount}/${maxCaught}`;
                gameMessage.textContent = '–¢—ñ–∫–∞–π –¥–æ –≤–∏—Ö–æ–¥—É!';
                gameMessage.style.color = '#feca57';

                startBtn.style.display = 'none';

                generateLevel();

                // Start timer
                if (timer) clearInterval(timer);
                timer = setInterval(() => {
                    timeLeft--;
                    timeDisplay.textContent = timeLeft;
                    if (timeLeft <= 0) {
                        gameOver(false);
                    }
                }, 1000);

                gameLoop();
            }

            // Event listeners
            document.addEventListener('keydown', (e) => {
                keys[e.code] = true;
                // Prevent scrolling with arrow keys when game is active
                if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.code) && gameRunning) {
                    e.preventDefault();
                }
            });

            document.addEventListener('keyup', (e) => {
                keys[e.code] = false;
            });

            startBtn.addEventListener('click', startGame);

            // Mobile controls
            document.querySelectorAll('.mobile-btn').forEach(btn => {
                const dir = btn.dataset.dir;
                const keyMap = {
                    'up': 'ArrowUp',
                    'down': 'ArrowDown',
                    'left': 'ArrowLeft',
                    'right': 'ArrowRight'
                };

                btn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    keys[keyMap[dir]] = true;
                });

                btn.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    keys[keyMap[dir]] = false;
                });

                btn.addEventListener('mousedown', () => keys[keyMap[dir]] = true);
                btn.addEventListener('mouseup', () => keys[keyMap[dir]] = false);
                btn.addEventListener('mouseleave', () => keys[keyMap[dir]] = false);
            });

            // Initial draw
            draw();
        })();
    </script>
</body>
</html>
